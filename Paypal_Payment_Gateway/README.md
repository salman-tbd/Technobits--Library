# PayPal Checkout Integration - Django + Next.js

A complete e-commerce PayPal integration using Django REST Framework backend and Next.js TypeScript frontend.

## 🚀 Features

### Backend (Django)
- ✅ PayPal Orders API v2 integration
- ✅ Secure OAuth authentication with PayPal
- ✅ Complete order lifecycle (create → capture)
- ✅ Webhook support for real-time notifications
- ✅ Transaction storage and audit logging
- ✅ RESTful API with comprehensive error handling
- ✅ Admin interface for transaction management

### Frontend (Next.js)
- ✅ TypeScript for type safety
- ✅ Dynamic PayPal SDK loading
- ✅ Responsive UI with Tailwind CSS
- ✅ Real-time payment processing
- ✅ Comprehensive error handling
- ✅ Loading states and user feedback

## 📋 Prerequisites

- Python 3.8+
- Node.js 16+
- PayPal Developer Account (for sandbox credentials)

## 🛠️ Setup Instructions

### 1. Get PayPal Credentials

1. Go to [PayPal Developer Dashboard](https://developer.paypal.com/)
2. Create a new app for sandbox testing
3. Copy your **Client ID** and **Secret Key**

### 2. Backend Setup (Django)

```bash
# Navigate to project root
cd /path/to/Ecommerce_Web

# Create virtual environment
python -m venv venv

# Activate virtual environment
# Windows:
venv\\Scripts\\activate
# macOS/Linux:
source venv/bin/activate

# Install dependencies
pip install -r requirements.txt

# Configure environment variables
cp .env.example .env

# Edit .env file with your PayPal credentials:
# PAYPAL_CLIENT_ID=your_paypal_sandbox_client_id
# PAYPAL_SECRET_KEY=your_paypal_sandbox_secret_key
```

### 3. Database Setup

```bash
# Run migrations
python manage.py makemigrations
python manage.py migrate

# Create superuser (optional)
python manage.py createsuperuser

# Start Django development server
python manage.py runserver
```

The Django API will be available at `http://localhost:8000`

### 4. Frontend Setup (Next.js)

```bash
# Navigate to frontend directory
cd frontend

# Install dependencies
npm install

# Configure environment variables
cp .env.local.example .env.local

# Edit .env.local with your PayPal Client ID:
# PAYPAL_CLIENT_ID=your_paypal_sandbox_client_id
# DJANGO_API_URL=http://localhost:8000

# Start Next.js development server
npm run dev
```

The frontend will be available at `http://localhost:3000`

## 🔧 API Endpoints

### PayPal Integration

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/paypal/create-order/` | Create PayPal order |
| POST | `/api/paypal/capture-order/` | Capture approved order |
| POST | `/api/paypal/webhook/` | Receive PayPal webhooks |
| GET | `/api/paypal/transaction-status/{order_id}/` | Get transaction status |

### Example API Usage

#### Create Order
```bash
curl -X POST http://localhost:8000/api/paypal/create-order/ \\
  -H "Content-Type: application/json" \\
  -d '{
    "amount": "10.00",
    "currency": "USD",
    "description": "Test payment"
  }'
```

#### Capture Order
```bash
curl -X POST http://localhost:8000/api/paypal/capture-order/ \\
  -H "Content-Type: application/json" \\
  -d '{
    "order_id": "PAYPAL_ORDER_ID"
  }'
```

## 🧪 Testing

### 1. Test PayPal Integration

1. Start both Django and Next.js servers
2. Visit `http://localhost:3000`
3. Enter an amount (e.g., "10.00")
4. Click PayPal button
5. Use sandbox buyer account:
   - Email: `sb-buyer@business.example.com`
   - Password: `password123`
6. Complete payment and verify success

### 2. Sandbox Test Accounts

Use these PayPal sandbox accounts for testing:

**Buyer Account:**
- Email: Create in PayPal Developer Dashboard
- Password: Generated by PayPal

**Business Account:**
- Your developer account credentials

### 3. Testing Webhooks (Optional)

1. Use ngrok to expose local server:
   ```bash
   ngrok http 8000
   ```

2. Configure webhook URL in PayPal Developer Dashboard:
   ```
   https://your-ngrok-url.ngrok.io/api/paypal/webhook/
   ```

3. Select these webhook events:
   - `PAYMENT.CAPTURE.COMPLETED`
   - `PAYMENT.CAPTURE.DENIED`

## 📁 Project Structure

```
Ecommerce_Web/
├── backend/                 # Django project settings
│   ├── settings.py         # Django configuration
│   ├── urls.py            # Main URL routing
│   └── wsgi.py            # WSGI application
├── payments/               # PayPal app
│   ├── models.py          # Database models
│   ├── views.py           # API views
│   ├── services.py        # PayPal service class
│   ├── urls.py            # App URLs
│   └── admin.py           # Admin configuration
├── frontend/               # Next.js application
│   ├── app/               # Next.js 14 app directory
│   ├── components/        # React components
│   ├── hooks/             # Custom React hooks
│   ├── lib/               # Utility libraries
│   ├── types/             # TypeScript definitions
│   └── package.json       # Frontend dependencies
├── requirements.txt        # Python dependencies
├── manage.py              # Django management script
└── README.md              # This file
```

## 🔒 Security Features

- Environment variables for sensitive configuration
- CORS protection for API endpoints
- PayPal OAuth authentication
- Request validation and error handling
- Transaction audit logging
- Webhook signature verification (optional)

## 🚀 Production Deployment

### Django Backend

1. **Environment Configuration:**
   ```bash
   DEBUG=False
   ALLOWED_HOSTS=yourdomain.com,www.yourdomain.com
   PAYPAL_BASE_URL=https://api-m.paypal.com  # Production URL
   ```

2. **Database:** Use PostgreSQL or MySQL instead of SQLite
3. **Static Files:** Configure static file serving
4. **HTTPS:** Enable SSL/TLS certificates

### Next.js Frontend

1. **Build for production:**
   ```bash
   npm run build
   npm start
   ```

2. **Environment Variables:**
   ```bash
   PAYPAL_CLIENT_ID=your_production_client_id
   DJANGO_API_URL=https://your-api-domain.com
   ```

## 📊 Admin Interface

Access Django admin at `http://localhost:8000/admin/` to:

- View all PayPal transactions
- Monitor payment statuses
- Review webhook events
- Manage user data

## 🐛 Troubleshooting

### Common Issues

1. **PayPal SDK not loading:**
   - Check PAYPAL_CLIENT_ID in environment variables
   - Verify internet connection
   - Check browser console for errors

2. **API connection errors:**
   - Ensure Django server is running on port 8000
   - Check CORS configuration
   - Verify DJANGO_API_URL in frontend .env.local

3. **Payment capture fails:**
   - Verify PayPal credentials
   - Check Django logs for API errors
   - Ensure order was created successfully

### Debug Mode

Enable debug logging in Django settings:

```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
        },
    },
    'loggers': {
        'payments': {
            'handlers': ['console'],
            'level': 'DEBUG',
        },
    },
}
```

## 📝 License

This project is for educational and demonstration purposes.

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## 📞 Support

For issues and questions:

1. Check the troubleshooting section
2. Review PayPal Developer Documentation
3. Create an issue in the repository

---

**Note:** This implementation uses PayPal's sandbox environment. For production use, update the PayPal URLs and use production credentials.
